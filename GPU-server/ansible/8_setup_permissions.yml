# ---------------------------------------------------------
# Grant ACL Permissions on /apps to cudauser Group
# ---------------------------------------------------------
- name: Grant ACL-based permissions to cudauser group on /apps
  hosts: ec2
  become: yes
  gather_facts: yes

  tasks:
    # Ensure 'acl' command-line utility is available
    - name: Ensure ACL package is installed
      apt:
        name: acl
        state: present
        update_cache: yes
      when: ansible_os_family == "Debian"

    # Grant read and execute permissions recursively to group cudauser
    - name: Grant read and execute (rx) permissions recursively to group cudauser
      command: setfacl -R -m g:cudauser:rx /apps

    # Set default ACL so future files/directories also inherit the same permission
    - name: Set default ACL for new files/folders in /apps for group cudauser
      command: setfacl -R -d -m g:cudauser:rx /apps
