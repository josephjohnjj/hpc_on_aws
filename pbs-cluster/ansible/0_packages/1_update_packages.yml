---
- name: Update packages on  on all nodes
  hosts: all
  become: yes
  tasks:
    - name: Set SELinux to permissive mode
      command: setenforce 0
      tags: disable_selinux

    - name: Set SELINUX to disabled in /etc/selinux/config
      ansible.builtin.lineinfile:
        path: /etc/selinux/config
        regexp: "^SELINUX="
        line: "SELINUX=disabled"
        state: present
        backrefs: yes
      tags: disable_selinux

    - name: Enable CRB repository
      ansible.builtin.shell: dnf config-manager --set-enabled crb
      args:
        executable: /bin/bash
      tags: repo

    - name: Enable plus repository
      ansible.builtin.shell: dnf config-manager --set-enabled plus
      args:
        executable: /bin/bash
      tags: repo

    - name: Update all packages
      ansible.builtin.dnf:
        name: "*"
        state: latest
      tags: update

    - name: Clean all DNF caches
      ansible.builtin.shell: dnf clean all
      args:
        executable: /bin/bash
      tags: dnf

    - name: Rebuild DNF cache
      ansible.builtin.shell: dnf makecache
      args:
        executable: /bin/bash
      tags: dnf

    

    - name: Reboot nodes
      reboot:
        reboot_timeout: 600
        test_command: whoami
      tags: reboot

    - name: Install EPEL repository
      ansible.builtin.dnf:
        name: epel-release
        state: present
      tags: epel

    - name: Install Development Tools group
      ansible.builtin.dnf:
        name: "@Development Tools"
        state: present
      tags: devtools

    - name: Install required packages
      dnf:
        name:
          - wget
          - vim
          - telnet
          - net-tools
          - python3
          - python3-devel
          - perl
          - autoconf
          - automake
          - gcc
          - gcc-c++
          - make
          - cmake
          - chkconfig
        state: present
      tags:
        - packages

