---
- name: Distribute slurm.conf and prepare Slurm directories on all nodes
  hosts: all
  become: true
  tasks:

    - name: Ensure /etc/slurm directory exists
      file:
        path: /etc/slurm
        state: directory
        owner: root
        group: root
        mode: '0755'

    - name: Copy slurm.conf to all nodes
      copy:
        src: slurm_config/slurm.conf
        dest: /etc/slurm/slurm.conf
        owner: root
        group: root
        mode: '0644'

    - name: Create Slurm state save directory
      file:
        path: /var/spool/slurm
        state: directory
        owner: slurm
        group: slurm
        mode: '0700'

    - name: Ensure slurmd spool directory exists
      file:
        path: /var/spool/slurmd
        state: directory
        owner: slurm
        group: slurm
        mode: '0700'
